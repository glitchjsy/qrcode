<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <style>
        .title {
            font-size: 50px;
            font-weight: 700;
        }

        .btn-black,
        .btn-black:hover {
            color: white;
            background-color: black;
            border-color: black;
        }

        .btn-gray {
            color: black;
            background-color: #e5e7eb;
            border-color: #e5e7eb;
        }

        .btn-gray:hover {
            background-color: #cfd3da;
            border-color: #cfd3da;
        }

        .btn {
            border-radius: 0;
        }

        #qrcode-placeholder {
            opacity: 0.5;
            width: 100%;
        }

        @media screen and (min-width: 768px) {
            .title {
                font-size: 60px;
            }
        }
    </style>
</head>

<body>
    <div class="container pt-5">
        <div class="text-center mb-5">
            <h1 class="title">QR Code Generator</h1>
        </div>
        <div class="row">
            <div class="col-12 col-lg-7">
                <div class="card">
                    <div class="card-body">
                        <div class="notification-container">
                            <div id="no-text" class="alert alert-danger d-none" role="alert">
                                <button type="button" class="close" data-dismiss="alert">Ã—</button>
                                Please provide text or a URL for the QR code
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="text">Text content</label>
                            <textarea id="text" name="text" class="form-control" maxlength="2048"></textarea>
                        </div>

                        <button class="btn btn-block btn-gray my-4" type="button" data-toggle="collapse"
                            data-target="#colors-container" data-collapse-button>
                            <i class="fa fa-fw fa-palette fa-sm mr-1"></i> Colours
                            <i class="fa fa-fw fa-chevron-down fa-sm" data-chevron-icon></i>
                        </button>

                        <div id="colors-container" class="collapse hide">
                            <div class="row">
                                <div class="col-sm-6 mb-4">
                                    <label for="foreground-color" class="form-label">Foreground colour</label>
                                    <input id="foreground-color" type="color"
                                        class="form-control form-control-color p-0" value="#000000"
                                        title="Choose a color">
                                </div>
                                <div class="col-sm-6">
                                    <label for="background-color" class="form-label">Background colour</label>
                                    <input id="background-color" type="color"
                                        class="form-control form-control-color p-0" value="#ffffff"
                                        title="Choose a color">
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-block btn-gray my-4" type="button" data-toggle="collapse"
                            data-target="#options-container" data-collapse-button="">
                            <i class="fa fa-fw fa-wrench fa-sm mr-1"></i> Options
                            <i class="fa fa-fw fa-chevron-down fa-sm" data-chevron-icon></i>
                        </button>

                        <div id="options-container" class="collapse hide">
                            <div class="form-group">
                                <label for="ecl"><i class="fa fa-fw fa-check fa-sm mr-1"></i> Error correction
                                    level</label>
                                <select id="ecl" name="ecl" class="form-control">
                                    <option value="L">L - low (7%)</option>
                                    <option value="M">M - medium (15%)</option>
                                    <option value="Q">Q - high (25%)</option>
                                    <option value="H">H - best (30%)</option>
                                </select>
                            </div>
                        </div>

                        <button id="create-button" type="button" class="btn btn-block btn-black">Create</button>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-5">
                <div class="card mb-4">
                    <div class="card-body">
                        <img id="qrcode-placeholder" src="/placeholder.png">
                        <div id="qrcode"></div>
                    </div>
                </div>
                <button id="download-button" type="button" class="btn btn-block btn-black dropdown-toggle"
                    data-toggle="dropdown" disabled>Download</button>
                <div class="dropdown-menu">
                    <div id="download-png" class="dropdown-item">Download as PNG (coming soon)</div>
                    <div id="download-svg" class="dropdown-item">Download as SVG</div>
                </div>
            </div>
        </div>

        <footer class="d-flex justify-content-between mt-5">
            <p>Created by <a href="https://github.com/lukeeey">Luke</a></p>
            <p><a href="https://github.com/glitchjsy/qrcode">Source code</a></p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>
    <script src="/qrcode.min.js"></script>

    <script>
        let cuurentCode;

        function generateCode() {
            // Remove the existing code
            $("#qrcode").html("");

            const text = $("#text").val();

            if (text === "") {
                $("#no-text").removeClass("d-none");
                return;
            }
            $("#qrcode-placeholder").addClass("d-none");
            $("#no-text").addClass("d-none");

            const qrcode = new QRCode({
                content: text,
                padding: 0,
                width: 256,
                height: 256,
                color: $("#foreground-color").val(),
                background: $("#background-color").val(),
                ecl: $("#ecl").val(),
                join: true,
                container: "svg-viewbox"
            });

            $("#download-button").prop("disabled", false);

            currentCode = qrcode;

            const svg = qrcode.svg();
            $("#qrcode").html(svg);
        }

        function download(type) {
            if (type === "svg") {
                const base64doc = btoa(unescape(encodeURIComponent($("#qrcode").html())));
                const a = document.createElement("a");
                const e = new MouseEvent("click");

                a.download = "download.svg";
                a.href = "data:text/html;base64," + base64doc;
                a.dispatchEvent(e);
            }
        }

        $(document).ready(function () {
            $("#create-button").on("click", generateCode);
            // $("#download-png").on("click", () => download("png"));
            $("#download-svg").on("click", () => download("svg"));

            $("[data-collapse-button]").each(function () {
                const target = $($(this).data("target"));
                const chevronIcon = $(this).find("[data-chevron-icon]");

                updateChevronIcon();

                target.on("shown.bs.collapse hidden.bs.collapse", function () {
                    updateChevronIcon();
                });

                function updateChevronIcon() {
                    if (target.hasClass("show")) {
                        chevronIcon.removeClass("fa-chevron-down").addClass("fa-chevron-up");
                    } else {
                        chevronIcon.removeClass("fa-chevron-up").addClass("fa-chevron-down");
                    }
                }
            });
        });
    </script>
</body>

</html>